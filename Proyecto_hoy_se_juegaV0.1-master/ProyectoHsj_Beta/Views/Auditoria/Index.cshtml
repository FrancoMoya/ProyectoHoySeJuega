@model IEnumerable<ProyectoHsj_Beta.ViewsModels.AuditoriaGetViewModel> 

@{
    Layout = "~/Views/Shared/Layout_admin.cshtml";
    ViewData["Title"] = "Auditoría";
}

<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <h3 class="text-center text-uppercase mb-4 text-white">Historial de Auditoría</h3>
            <!-- Modificación: Botones de filtro para las acciones -->
            <div class="mb-3 text-center">
                <!-- Botones en grupo para estar pegados -->
                <div class="btn-group btn-group-toggle" data-toggle="buttons">
                    <button class="btn btn-primary" onclick="filterActions('TODOS')">TODOS</button>
                    <button class="btn btn-success" onclick="filterActions('CREACIÓN')">CREACIÓN</button>
                    <button class="btn btn-warning" onclick="filterActions('MODIFICACIÓN')">MODIFICACIÓN</button>
                    <button class="btn btn-danger" onclick="filterActions('ELIMINACIÓN')">ELIMINACIÓN</button>
                </div>
            </div>

            <!-- Estilo para mostrar en tarjetas SOLO en pantallas pequeñas -->
            <div class="row d-block d-md-none g-2">
                @foreach (var item in Model)
                {
                    <div class="col-12 col-sm-6 col-md-4 mb-1" data-action="@item.TituloAccionRealizada">
                        <div class="card text-white bg-dark">
                            <div class="card-body">
                                <h5 class="card-title">@item.TituloAccionRealizada</h5>
                                <p class="card-text">
                                    <strong>Fecha:</strong> @item.FechaAuditoria<br/>
                                    <strong>Nombre:</strong> @item.NombreUsuario @item.ApellidoUsuario<br/>
                                    <strong>Sección:</strong> @item.Seccion<br/>
                                    <strong>Descripción:</strong> @item.DescripcionDeAccion
                                </p>
                            </div>
                        </div>
                    </div>
                }
            </div>

            <!-- Tabla solo visible en pantallas grandes (desktop) -->
            <div class="table-responsive d-none d-md-block">
                <table class="table table-striped table-bordered table-dark">
                    <thead class="thead-light">
                        <tr class="text-center">
                            <th>Fecha</th>
                            <th>Acción realizada</th>
                            <th>Nombre</th>
                            <th>Apellido</th>
                            <th>Sección</th>
                            <th>Descripción</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr class="text-center align-middle" data-action="@item.TituloAccionRealizada">
                                <td>@item.FechaAuditoria.ToString("HH:mm:ss - dd/MM/yyyy")</td>
                                <td>@Html.DisplayFor(modelItem => item.TituloAccionRealizada)</td>
                                <td>@Html.DisplayFor(modelItem => item.NombreUsuario)</td>
                                <td>@Html.DisplayFor(modelItem => item.ApellidoUsuario)</td>
                                <td>@Html.DisplayFor(modelItem => item.Seccion)</td>
                                <td>@Html.DisplayFor(modelItem => item.DescripcionDeAccion)</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- CSS para cambiar el color del texto a blanco -->
<style>
    .text-white {
        color: white;
    }

    body {
        background-image: url('/css/img/logo fondo admin.png');
        background-size: cover; /* Ajusta la imagen para cubrir todo el fondo */
        background-repeat: no-repeat; /* Evita que la imagen se repita */
        background-attachment: fixed; /* Mantiene la imagen fija al hacer scroll */
        background-position: center; /* Centra la imagen de fondo */
    }

    .container {
        position: relative;
        z-index: 1;
    }

    h1 {
        font-size: 2.5rem;
        font-weight: bold;
    }

    table {
        font-size: 0.9rem;
    }

    .table-responsive {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }

    /* Estilos para las tarjetas */
    .card {
        border: none;
    }

    .card-title {
        font-size: 1.1rem;
        font-weight: bold;
    }

    .card-text {
        font-size: 0.9rem;
    }

    /* Asegurar que las tarjetas se vean bien en pantallas pequeñas */
    @@media (max-width: 768px) {
        .card-text {
            font-size: 0.85rem;
        }
    }

    /* Mostrar tarjetas solo en pantallas pequeñas */
    @@media (max-width: 767px) {
        .d-block.d-md-none {
            display: block !important;  /* Aseguramos que las tarjetas se muestren en móviles */
        }
    }

    /* Ocultar la tabla en pantallas pequeñas y mostrar en pantallas grandes */
    @@media (min-width: 768px) {
        .d-none.d-md-block {
            display: block !important; /* Aseguramos que la tabla solo se muestre en pantallas grandes */
        }
    }

    /* Estilos para los botones pegados */
    .btn-group .btn {
        margin: 0; /* Sin márgenes entre los botones */
    }
</style>

<!-- Script para el filtrado -->
<script>
    // Función para filtrar las tarjetas y filas de la tabla según la acción realizada
    function filterActions(action) {
        // Obtener todas las tarjetas y filas de la tabla por el atributo data-action
        var cardItems = document.querySelectorAll('[data-action]');
        var tableItems = document.querySelectorAll('tr[data-action]');

        // Filtrar tarjetas
        cardItems.forEach(function (card) {
            // Mostrar tarjeta si el action es 'TODOS' o si el 'data-action' de la tarjeta coincide
            if (action === 'TODOS' || card.getAttribute('data-action') === action) {
                card.style.display = 'block'; // Mostrar la tarjeta
            } else {
                card.style.display = 'none'; // Ocultar la tarjeta
            }
        });

        // Filtrar filas de la tabla
        tableItems.forEach(function (row) {
            // Mostrar fila si el action es 'TODOS' o si el 'data-action' de la fila coincide
            if (action === 'TODOS' || row.getAttribute('data-action') === action) {
                row.style.display = ''; // Mostrar la fila
            } else {
                row.style.display = 'none'; // Ocultar la fila
            }
        });
    }
</script>
